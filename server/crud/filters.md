# Фильтры

Фильтрация используется в методах получения данных, в частности в
getItems.

Пример фильтрации с группировкой. (Ищем сотрудника с email
"ivanov_ivan@domain.com" или Его имя "Иван" и возраст больше 20)

Запрос: `domain/Service/Employee/getItems`

JSON payload

```json
{
  "filter": [
    ["email", "eq", "ivanov_ivan@domain.com"],
   "OR",
    [
      ["full_name", "co", "Иван"],
      "AND",
      ["email", "ge", 20]
    ]
  ]
}
```

Таблица соответствий фильтров и sql операций

| Оператор | Описание                                                                                                                  | Пример в SQL                                   |
|:--------:|:--------------------------------------------------------------------------------------------------------------------------|:-----------------------------------------------|
|   `eq`   | Ищет точное соответствие                                                                                                  | `"full_name"="Иванов Иван Иванович"`           |
|   `eqi`  | Ищет точное соответствие (регистро-независимый режим)                                                                     | `"full_name" ILIKE "иванов иван иванович"`     |
|   `ne`   | Возвращает строки, которые не равны значению                                                                              | `"full_name"!="Иванов Иван Иванович"`          |
|   `nei`  | Возвращает строки, которые не равны значению (регистро-независимый режим)                                                 | `"full_name" NOT ILIKE "иванов иван иванович"` |
|   `gt`   | Возвращает строки, в которых значение поля больше значению аргумента (см. правила сравнения типов данных в бд)            | `"price" > 1000`                               |
|   `lt`   | Возвращает строки, в которых значение поля меньше значению аргумента                                                      | `"price" < 1000`                               |
|   `ge`   | Возвращает строки, в которых значение поля больше или равно значению аргумента                                            | `"price" >= 1000`                              | 
|   `le`   | Возвращает строки, в которых значение поля меньше или равно значению аргумента                                            | `"price" <= 1000`                              |
|   `co`   | Возвращает строки, в которых значение поля содержит частичное соответствие искомой строки                                 | `"full_name" LIKE "%Иван%"`                    |
|   `coi`  | Возвращает строки, в которых значение поля содержит частичное соответствие искомой строки (регистро-независимый режим)    | `"full_name" ILIKE "%Иван%"`                   |
|   `nc`   | Возвращает строки, в которых значение поля не содержит частичное соответствие искомой строки                              | `"full_name" NOT LIKE "%Иван%"`                |
|   `nci`  | Возвращает строки, в которых значение поля не содержит частичное соответствие искомой строки (регистро-независимый режим) | `"full_name" NOT ILIKE "%Иван%"`               |
|   `sw`   | Возвращает строки, в которых значение поля начинается с искомой строки                                                    | `"full_name" LIKE "Иван%"`                     |
|   `swi`  | Возвращает строки, в которых значение поля начинается с искомой строки (регистро-независимый режим)                       | `"full_name" ILIKE "Иван%"`                    |
|   `ew`   | Возвращает строки, в которых значение поля оканчивается искомой строкой                                                   | `"full_name" LIKE "%Иван"`                     |
|   `ewi`  | Возвращает строки, в которых значение поля оканчивается искомой строкой (регистро-независимый режим)                      | `"full_name" ILIKE "%Иван"`                    |
|   `or`   | Оператор логическое ИЛИ. Используется для составления более сложных условий                                               | `"price" > 1000 OR "price" < 2000`             | 
|   `and`  | Оператор логическое И. Используется для составления более сложных условий                                                 | `"price" > 1000 AND "price" < 2000`            |


### Фильтрация по связанным сущностям

`["relation_name.field_name", "operator", "value"]`

Фильтрация по отношению выполняется через обращение к названию отношения
(прописанного в метаданных).

> :warning: Для фильтрации по отношениям должен быть указан
> соответствующий `property-type` у `property`. Смотри
> [документацию](/server/metadata.md#Перечень-тегов).

Пример поиска сотрудников по названию отдела.

Запрос: `domain/Service/Employee/getItems`

JSON payload

```json
{
  "filter": [
    ["departments.name", "eq", "Отдел маркетинга"]
  ]
}
```
### Фильтрация по наличию/отсутствию свзяи 

`["relation_name.exists()", "eq", "value"]`

В качестве `value` можно передавать только `true/false`.

Пример поиска отделов, имеющих хотя бы одного сотрудника.

Запрос: `domain/Service/Department/getItems`

JSON payload

```json
{
  "filter": [
    ["users.exists()", "eq", true]
  ]
}
```
